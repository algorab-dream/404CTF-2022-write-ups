import os
import time
import sys

def distance(a,b):
    a = list(a)
    b = list(b)
    distance = len(a)
    for i in range(len(a)):
        if a[i] != b[i]:
            return distance
        distance -= 1
    return distance

def clean_dict(flag_dict):
    dict_return = {}
    max_length = len(list(flag_dict.keys())[-1])
    for flag in list(flag_dict.keys()):
        if len(flag) >= max_length:
            dict_return[flag] = flag_dict[flag]
    return dict_return




alphabet = list('azertyuiopqsdfghjklmwxcvbnAZERTYUIOPQSDFGHJKLMWXCVBN1234567890}')
hash_target = open('hash.txt','r').read()
flag_dict = {'404CTF{':os.popen('python3 ./hash.py 404CTF{').read()}

found = False
while True:
    for flag in list(flag_dict.keys()):
        flag_dict_ = {}
        for k in range(len(alphabet)):
            flag_ = flag + alphabet[k]
            print('Testing input : %s' % flag_,end='\r')
            hash_ = os.popen('python3 ./hash.py %s' % flag_).read()
            for i in range(len(hash_target)):
                if (list(hash_[:i]) == list(hash_target[:i])) and (list(hash_[:i]) != list(list(flag_dict.values())[-1][:i])):
                    flag_dict_[flag_] = hash_
                    break
        if flag_dict_:
            min_dist = distance(list(flag_dict_.values())[0],hash_target)
            for i in range(len(flag_dict_)):
                if distance(list(flag_dict_.values())[i],hash_target) <= min_dist:
                    min_dist = distance(list(flag_dict_.values())[i],hash_target)
                    flag_dict[list(flag_dict_.keys())[i]] = list(flag_dict_.values())[i]
                    if list(list(flag_dict_.values())[i])[-1] == '}':
                        print('Found : %s !' % list(flag_dict_.values())[i])
                        sys.exit(0)
    flag_dict = clean_dict(flag_dict)

        
